#!/usr/bin/env bash 

ME_ANSI_END="\e[0m"
ME_ANSI_BOLD="\e[1m"
ME_ANSI_RED="\e[91m"
ME_ANSI_GREEN="\e[92m"
ME_ANSI_YELLOW="\e[93m"
ME_ANSI_BLUE="\e[94m"
ME_ANSI_MAGENTA="\e[95m"
ME_ANSI_CYAN="\e[96m"
ME_ANSI_WHITE="\e[97m"

lib_me_dir=LIB_ME_DIR

me_subcmds=(
  $(find $lib_me_dir -name 'me-*' -printf "%f\n" | cut -c 4-) )
me_subcmds_filter=$(IFS='|'; echo "${me_subcmds[*]}")

usage() {
  cat <<EOF
Usage: me <command> [<args>]

Commands:
  info                  Display messages with level INFO
  warn                  Display messages with level WARN
  err                   Display messages with level ERR
EOF

  local subcmd
  for subcmd in ${me_subcmds[@]}; do
    printf "  %s\t\t%s\n" \
      "$subcmd"  "$(sed -nr '2 s/#\s*(.*)/\1/p' $lib_me_dir/me-$subcmd)"
  done
}

if [[ $1 == info ]]; then
  shift
  echo -e "${ME_ANSI_BOLD}${ME_ANSI_BLUE}${*}${ME_ANSI_END}"

elif [[ $1 == warn ]]; then
  shift
  echo -e "${ME_ANSI_BOLD}${ME_ANSI_YELLOW}${*}${ME_ANSI_END}"

elif [[ $1 == err ]]; then
  shift
  echo -e "${ME_ANSI_BOLD}${ME_ANSI_RED}${*}${ME_ANSI_END}"

elif [[ $1 =~ $me_subcmds_filter ]]; then
  $lib_me_dir/me-$1

else
  usage

fi
